/**
 * @license Copyright 2014 Martin Matysiak.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var PanoMarker=function(e){e=e||{};this.anchor_=e.anchor||new google.maps.Point(16,16);this.className_=e.className||null;this.clickable_=e.clickable||true;this.icon_=e.icon||null;this.id_=e.id||null;this.marker_=null;this.pano_=null;this.pollId_=-1;this.position_=e.position||{heading:0,pitch:0};this.povListener_=null;this.size_=e.size||new google.maps.Size(32,32);this.title_=e.title||"";this.visible_=e.visible||true;this.zIndex_=e.zIndex||1;this.setPano(e.pano||null)};PanoMarker.prototype=new google.maps.OverlayView;PanoMarker.getFov=function(e){return e<=2?126.5-e*36.75:195.93/Math.pow(1.92,e)};PanoMarker.povToPixel=function(e,t,n){var r=n.offsetWidth;var i=n.offsetHeight;var s={left:r/2,top:i/2};var o=Math.PI/180;var u=PanoMarker.getFov(t.zoom||1)*o;var a=t.heading*o;var f=t.pitch*o;var l=e.heading*o;var c=e.pitch*o;var h=r/2/Math.tan(u/2);var p=Math.cos(c);var d=Math.sin(c);var v=Math.cos(l);var m=Math.sin(l);var g=h*p*m;var y=h*p*v;var b=h*d;var w=Math.cos(f);var E=Math.sin(f);var S=Math.cos(a);var x=Math.sin(a);var T=h*w*x;var N=h*w*S;var C=h*E;var k=T*g+N*y+C*b;var L=T*T+N*N+C*C;if(Math.abs(k)<1e-6){return null}var A=L/k;if(A<0){return null}var O=A*g;var M=A*y;var _=A*b;var D=-E*x;var P=-E*S;var H=w;var B=S;var j=-x;var F=0;var I=Math.sqrt(B*B+j*j+F*F);B/=I;j/=I;F/=I;var q=O*B+M*j+_*F;var R=O*D+M*P+_*H;s.left+=q;s.top-=R;return s};PanoMarker.prototype.onAdd=function(){var e=document.createElement("div");e.style.position="absolute";e.style.cursor="pointer";e.style.width=this.size_.width+"px";e.style.height=this.size_.height+"px";e.style.display=this.visible_?"block":"none";e.style.zIndex=this.zIndex_;if(this.id_){e.id=this.id_}if(this.className_){e.className=this.className_}if(this.title_){e.title=this.title_}if(this.icon_){e.style.backgroundImage="url("+this.icon_+")"}if(!(this.id_||this.className_||this.icon_)){e.style.backgroundImage="url(https://www.google.com/intl/en_us/"+"mapfiles/ms/micons/red-dot.png)"}this.marker_=e;this.getPanes().overlayMouseTarget.appendChild(e);window.addEventListener("resize",this.draw.bind(this));this.povListener_=google.maps.event.addListener(this.getMap(),"pov_changed",this.draw.bind(this));if(e.attachEvent){e.attachEvent("onclick",this.onClick.bind(this))}else{e.addEventListener("click",this.onClick.bind(this),false)}this.draw()};PanoMarker.prototype.draw=function(){if(!this.pano_){return}var e=PanoMarker.povToPixel(this.position_,this.pano_.getPov(),this.pano_.getContainer());if(e!==null){this.marker_.style.left=e.left-this.anchor_.x+"px";this.marker_.style.top=e.top-this.anchor_.y+"px"}};PanoMarker.prototype.onClick=function(e){if(this.clickable_){google.maps.event.trigger(this,"click")}e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation()}};PanoMarker.prototype.onRemove=function(){google.maps.event.removeListener(this.povListener_);this.marker_.parentNode.removeChild(this.marker_);this.marker_=null};PanoMarker.prototype.getAnchor=function(){return this.anchor_};PanoMarker.prototype.getClassName=function(){return this.className_};PanoMarker.prototype.getClickable=function(){return this.clickable_};PanoMarker.prototype.getIcon=function(){return this.icon_};PanoMarker.prototype.getId=function(){return this.id_};PanoMarker.prototype.getPano=function(){return this.pano_};PanoMarker.prototype.getPosition=function(){return this.position_};PanoMarker.prototype.getSize=function(){return this.size_};PanoMarker.prototype.getTitle=function(){return this.title_};PanoMarker.prototype.getVisible=function(){return this.visible_};PanoMarker.prototype.getZIndex=function(){return this.zIndex_};PanoMarker.prototype.setAnchor=function(e){this.anchor_=e;this.draw()};PanoMarker.prototype.setClassName=function(e){this.className_=e;if(!!this.marker_){this.marker_.className=e}};PanoMarker.prototype.setClickable=function(e){this.clickable_=e};PanoMarker.prototype.setIcon=function(e){this.icon_=e;if(!!this.marker_){this.marker_.style.backgroundImage=!!e?"url("+e+")":""}};PanoMarker.prototype.setId=function(e){this.id_=e;if(!!this.marker_){this.marker_.id=e}};PanoMarker.prototype.setPano=function(e){if(!!e&&!(e instanceof google.maps.StreetViewPanorama)){throw"PanoMarker only works inside a StreetViewPanorama."}if(!!this.pano_){this.onRemove()}this.setMap(e);this.pano_=e;if(!!e){if(!!this.getPanes()){this.onAdd()}else{var t=function(){if(!!this.getPanes()){window.clearInterval(this.pollId_);this.onAdd()}};this.pollId_=window.setInterval(t.bind(this),10)}}};PanoMarker.prototype.setPosition=function(e){this.position_=e;this.draw()};PanoMarker.prototype.setSize=function(e){this.size_=e;if(!!this.marker_){this.marker_.style.width=e.width+"px";this.marker_.style.height=e.height+"px";this.draw()}};PanoMarker.prototype.setTitle=function(e){this.title_=e;if(!!this.marker_){this.marker_.title=e}};PanoMarker.prototype.setVisible=function(e){this.visible_=e;if(!!this.marker_){this.marker_.style.display=e?"block":"none"}};PanoMarker.prototype.setZIndex=function(e){this.zIndex_=e;if(!!this.marker_){this.marker_.style.zIndex=e}}
